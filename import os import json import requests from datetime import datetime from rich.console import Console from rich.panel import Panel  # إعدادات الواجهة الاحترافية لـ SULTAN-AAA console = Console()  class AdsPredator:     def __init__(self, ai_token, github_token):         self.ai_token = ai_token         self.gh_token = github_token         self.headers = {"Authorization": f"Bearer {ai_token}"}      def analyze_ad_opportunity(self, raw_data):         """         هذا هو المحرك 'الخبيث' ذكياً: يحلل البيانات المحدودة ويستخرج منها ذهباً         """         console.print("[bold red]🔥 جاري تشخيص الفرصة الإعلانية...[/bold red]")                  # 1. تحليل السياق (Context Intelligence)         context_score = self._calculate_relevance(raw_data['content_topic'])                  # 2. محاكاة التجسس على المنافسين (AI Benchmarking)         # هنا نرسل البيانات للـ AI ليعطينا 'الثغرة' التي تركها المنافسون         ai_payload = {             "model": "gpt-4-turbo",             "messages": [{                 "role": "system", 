import os
import json
import requests
from datetime import datetime
from rich.console import Console
from rich.panel import Panel

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù€ SULTAN-AAA
console = Console()

class AdsPredator:
    def __init__(self, ai_token, github_token):
        self.ai_token = ai_token
        self.gh_token = github_token
        self.headers = {"Authorization": f"Bearer {ai_token}"}

    def analyze_ad_opportunity(self, raw_data):
        """
        Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø­Ø±Ùƒ 'Ø§Ù„Ø®Ø¨ÙŠØ«' Ø°ÙƒÙŠØ§Ù‹: ÙŠØ­Ù„Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø© ÙˆÙŠØ³ØªØ®Ø±Ø¬ Ù…Ù†Ù‡Ø§ Ø°Ù‡Ø¨Ø§Ù‹
        """
        console.print("[bold red]ğŸ”¥ Ø¬Ø§Ø±ÙŠ ØªØ´Ø®ÙŠØµ Ø§Ù„ÙØ±ØµØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©...[/bold red]")
        
        # 1. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ù‚ (Context Intelligence)
        context_score = self._calculate_relevance(raw_data['content_topic'])
        
        # 2. Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ¬Ø³Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ† (AI Benchmarking)
        # Ù‡Ù†Ø§ Ù†Ø±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù€ AI Ù„ÙŠØ¹Ø·ÙŠÙ†Ø§ 'Ø§Ù„Ø«ØºØ±Ø©' Ø§Ù„ØªÙŠ ØªØ±ÙƒÙ‡Ø§ Ø§Ù„Ù…Ù†Ø§ÙØ³ÙˆÙ†
        ai_payload = {
            "model": "gpt-4-turbo",
            "messages": [{
                "role": "system", 
                "content": "Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø³Ø±ÙŠ. Ø­Ù„Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø³ØªØ®Ø±Ø¬ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†."
            }, {
                "role": "user", 
                "content": json.dumps(raw_data)
            }]
        }
        
        # (Ù…Ø­Ø§ÙƒØ§Ø© Ø·Ù„Ø¨ AI)
        ai_recommendation = "Ø§Ù„Ù…Ù†Ø§ÙØ³ÙˆÙ† ÙŠØªØ¬Ø§Ù‡Ù„ÙˆÙ† ÙØ¦Ø© Ø§Ù„Ø´Ø¨Ø§Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª. Ø§Ø¶Ø±Ø¨ Ø§Ù„Ø¢Ù†!"
        
        return {
            "score": context_score,
            "recommendation": ai_recommendation,
            "timestamp": datetime.now().isoformat()
        }

    def _calculate_relevance(self, topic):
        # Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Sultan-AAA Ø§Ù„Ø®Ø§ØµØ© Ù„Ø­Ø³Ø§Ø¨ Ù‚ÙˆØ© Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·
        return 98.5 if "Electric" in topic else 75.0

    def generate_pro_report(self, analysis):
        """ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± ÙŠØ¶Ø§Ù‡ÙŠ ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„ÙƒØ¨Ø±Ù‰"""
        report_md = f"""
        # ğŸ“Š ØªÙ‚Ø±ÙŠØ± Sultan-AAA Ads Predator
        **Ø§Ù„Ø­Ø§Ù„Ø©:** ÙØ±ØµØ© Ø°Ù‡Ø¨ÙŠØ©
        **Ø§Ù„ØªÙˆØµÙŠØ©:** {analysis['recommendation']}
        **Ø¯Ù‚Ø© Ø§Ù„ØªÙˆÙ‚Ø¹:** {analysis['score']}%
        ---
        *ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Qadr AI*
        """
        return report_md

    def deploy_to_cloud(self, report_content):
        # Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ GitHub Ùˆ Gmail ÙƒÙ…Ø§ Ø·Ù„Ø¨Ù†Ø§ Ø³Ø§Ø¨Ù‚Ø§Ù‹
        console.print("[bold green]ğŸ“¤ ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù„Ù…Ù‚Ø± Ø§Ù„Ø³Ø±ÙŠ (GitHub)...[/bold green]")
        # ÙƒÙˆØ¯ Ø§Ù„Ø±ÙØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ Ù‡Ù†Ø§...

# --- Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ (The Master Run) ---
if __name__ == "__main__":
    # Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª 'Ø§Ù„Ù…Ø­Ø¯ÙˆØ¯Ø©' Ø§Ù„ØªÙŠ Ø­ØµÙ„Ù†Ø§ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹
    captured_data = {
        "content_topic": "Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø£Ø®Ø¶Ø±",
        "user_location": "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ù…Ø£Ù‡ÙˆÙ„",
        "device": "iPhone 15 Pro",
        "time_spent": "120s",
        "time": "19:30 (ÙˆÙ‚Øª Ø°Ø±ÙˆØ©)"
    }

    predator = AdsPredator(ai_token="SULTAN_KEY", github_token="GH_KEY")
    
    # Ø§Ù„Ø®Ù„Ø·Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ©
    final_analysis = Qadrpredator.analyze_ad_opportunity(captured_data)
    report = predator.generate_pro_report(final_analysis)
    
    # Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù€ SULTAN-AAA
    console.print(Panel(report, title="[bold gold1]Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©[/bold gold1]", expand=False))
