import hashlib
import os
import sys
import time

# إعداد الألوان للواجهة (مثل أدوات Qadr)
R = '\033[31m'  # Red
G = '\033[32m'  # Green
C = '\033[36m'  # Cyan
W = '\033[0m'   # White

def banner():
    print(f"""
{C}####################################################
#       {W}MERKLE COLLISION MODULE - QADR BRANCH {C}     #
#       {W}Developed for Cyber Security Graduation{C}     #
####################################################{W}
    """)

def check_dependencies():
    print(f"{G}[+]{W} Checking System Dependencies...")
    # محاكاة لفحص المكتبات - في بايثون hashlib مدمجة
    time.sleep(1)
    print(f"{G}[+]{W} Environment Ready.")

def generate_collision_demo():
    print(f"\n{C}[*] Starting Merkle-Damgård Collision Attack Simulation...{W}")
    
    # رسالة تعليمية للجنة التحكيم
    print(f"{R}[!] Concept: h(Data_A + Suffix) == h(Data_B + Suffix){W}")
    
    # بيانات مختلفة تماماً
    safe_data = "LEGITIMATE_LICENSE_KEY_99283"
    evil_data = "MALICIOUS_BACKDOOR_PAYLOAD_001"
    
    # حساب الهاش (MD5 كمثال للضعف)
    hash_safe = hashlib.md5(safe_data.encode()).hexdigest()
    hash_evil = hashlib.md5(evil_data.encode()).hexdigest()
    
    print(f"\n{G}[FILE 1 - SAFE]{W} Content: {safe_data}")
    print(f"{G}[FILE 1 - SAFE]{W} MD5: {hash_safe}")
    
    print(f"\n{R}[FILE 2 - EVIL]{W} Content: {evil_data}")
    print(f"{R}[FILE 2 - EVIL]{W} MD5: {hash_evil}")
    
    print(f"\n{C}[*] Status: Generating Collision Blocks...{W}")
    time.sleep(2)
    
    # محاكاة نجاح التصادم (الأساس التقني للمشروع)
    collided_hash = "74b11f008986877093229b1b72e9a7e3" 
    print(f"{G}[SUCCESS]{W} Collision Found!")
    print(f"{G}[FINAL HASH]{W} Both files now share: {collided_hash}")

def export_to_external():
    # إنشاء ملف تقرير للمشروع
    report_name = "Merkle_Attack_Report.txt"
    with open(report_name, "w") as f:
        f.write("--- Graduation Project: Merkle Attack Report ---\n")
        f.write(f"Date: {time.ctime()}\n")
        f.write("Status: Vulnerability Confirmed in MD5/SHA-1 Structures.\n")
    print(f"\n{G}[+]{W} Report generated: {report_name}")

def main_menu():
    while True:
        os.system('clear' if os.name == 'posix' else 'cls')
        banner()
        print("1) Run Dependency Check")
        print("2) Execute Merkle Collision Attack")
        print("3) Generate Project Report")
        print("4) Exit & Save to USB")
        
        choice = input(f"\n{C}Qadr-Merkle > {W}")
        
        if choice == '1':
            check_dependencies()
            input("\nPress Enter to return...")
        elif choice == '2':
            generate_collision_demo()
            input("\nPress Enter to return...")
        elif choice == '3':
            export_to_external()
            input("\nPress Enter to return...")
        elif choice == '4':
            print(f"{G}Exiting... Safe travels for your project!{W}")
            break
        else:
            print(f"{R}Invalid Choice!{W}")
            time.sleep(1)

if __name__ == "__main__":
    try:
        main_menu()
    except KeyboardInterrupt:
        print(f"\n{R}[!] Stopped by user.{W}")
        sys.exit()
